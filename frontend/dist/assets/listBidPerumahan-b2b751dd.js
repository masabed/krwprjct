import{L as E,P as j}from"./page-header-7252a4a4.js";import{K}from"./KecKelurahanList-556de1ec.js";import{S as h}from"./sweetalert2.esm.all-cdd2d7a4.js";import{_ as q,h as d,j as p,E as f,q as o,m as s,l as t,A as r,k as b,B,F as v,x as m,C as I,y as U}from"./index-234163e1.js";import"./logo-dark-92140013.js";import"./SIIMAH-e113b49b.js";const z={name:"ListbidPerumahan",components:{Layout:E,PageHeader:j},data(){return{title:"Bidang Perumahan",items:[{text:"Menu"},{text:"Bidang Perumahan",active:!0}],selectedKecamatan:"All",selectedKelurahan:"All",dataList:[],totalRows:1,tabIndex:1,currentPage:1,perPage:10,pageOptions:[10,25,50,100],filter:null,sortKey:null,sortAsc:!0,fields:[{key:"nama_cpcl",sortable:!0,label:"Nama CPCL"},{key:"kontraktor_pelaksana",sortable:!0,label:"Kontraktor"},{key:"kegiatan",sortable:!0,label:"Kegiatan"},{key:"kecamatan",sortable:!0,label:"Kecamatan"},{key:"kelurahan",sortable:!0,label:"Kelurahan"},{key:"tanggal_selesai_raw",sortable:!0,label:"Tanggal Selesai"},{key:"photo_count",sortable:!0,label:"Jumlah Foto"},{key:"pdf_count",sortable:!0,label:"Jumlah Dokumen"},{key:"action",label:"Action"}]}},computed:{rows(){return this.filteredList.length},uniqueKecamatan(){return["All",...Object.keys(K)]},uniqueKelurahan(){return!this.selectedKecamatan||this.selectedKecamatan==="All"?[]:["All",...K[this.selectedKecamatan]||[]]},filteredList(){let n=[...this.dataList].filter(e=>(!this.selectedKecamatan||this.selectedKecamatan==="All"||e.kecamatan===this.selectedKecamatan)&&(!this.selectedKelurahan||this.selectedKelurahan==="All"||e.kelurahan===this.selectedKelurahan)&&(!this.filter||Object.values(e).some(u=>String(u).toLowerCase().includes(this.filter.toLowerCase()))));return this.sortKey&&n.sort((e,u)=>{const _=e[this.sortKey],l=u[this.sortKey];return this.sortAsc?String(_).localeCompare(String(l)):String(l).localeCompare(String(_))}),n},computedFilteredDataList(){return this.filteredList.slice((this.currentPage-1)*this.perPage,this.currentPage*this.perPage)}},watch:{selectedKecamatan(){this.selectedKelurahan="All"}},mounted(){this.fetchData()},methods:{goToEdit(n){this.$router.push({name:"editDataPerumahan",params:{id:n}})},scrollPagination(n){const e=this.$el.querySelector(".pagination-scroll"),u=100;e.scrollBy({left:n==="left"?-u:u,behavior:"smooth"})},async fetchData(){try{const n=await this.$axios.get("/perumahan/bidangPerumahan");n.data.success&&(this.dataList=n.data.data.map(e=>({...e,tanggal_selesai_raw:e.tanggal_selesai,tanggal_selesai:this.formatDate(e.tanggal_selesai)})),this.totalRows=this.dataList.length)}catch(n){console.error("Failed to fetch data:",n)}},async deleteEntry(n){if((await h.fire({title:"Hapus Data?",text:"Data yang dihapus tidak bisa dikembalikan.",icon:"warning",showCancelButton:!0,confirmButtonText:"Ya, hapus!",cancelButtonText:"Batal",reverseButtons:!0})).isConfirmed)try{(await this.$axios.delete(`/perumahan/${n}`)).data.success?(h.fire("Berhasil!","Data berhasil dihapus.","success"),this.fetchData()):h.fire("Gagal","Data gagal dihapus.","error")}catch{h.fire("Error","Terjadi kesalahan saat menghapus data.","error")}},onAddData(){this.$router.push({name:"addDataPerumahan"})},resetFilters(){this.selectedKecamatan="All",this.selectedKelurahan="All",this.filter=null,this.currentPage=1},formatDate(n){const e={year:"numeric",month:"long",day:"numeric"};return new Date(n).toLocaleDateString("en-GB",e)},setSort(n){this.sortKey===n?this.sortAsc=!this.sortAsc:(this.sortKey=n,this.sortAsc=!0)}}},N={class:"row"},H={class:"col-lg-12"},O={class:"card"},R={class:"card-body pt-1"},G={class:"row mt-4 mb-2 align-items-end"},J={class:"col-md-4"},M={class:"col-md-4"},Y={class:"col-md-4"},Q={class:"row mt-1"},W={class:"col-md-12 text-end"},X={class:"row mt-2"},Z={class:"col-sm-12 col-md-6"},$={class:"d-inline-flex align-items-center"},ee={class:"col-sm-12 col-md-6 text-md-end"},te={class:"d-inline-flex align-items-center"},ae={class:"table-responsive mt-3"},le=["onClick"],se=["onClick"],ne=["onClick"],oe={class:"col-12 text-center"},re={class:"pagination-wrapper d-flex align-items-center justify-content-center"},ie={class:"pagination-scroll overflow-auto"},de={class:"pagination pagination-rounded mb-0 d-flex justify-content-center"};function ue(n,e,u,_,l,i){const w=d("PageHeader"),g=d("BFormSelect"),P=d("BFormInput"),x=d("BTh"),k=d("BTr"),T=d("BThead"),c=d("BTd"),A=d("BTbody"),C=d("BTableSimple"),D=d("BPagination"),V=d("BTab"),L=d("BTabs"),S=d("Layout");return p(),f(S,null,{default:o(()=>[s(w,{title:l.title,items:l.items},null,8,["title","items"]),t("div",N,[t("div",H,[t("div",O,[t("div",R,[s(L,{modelValue:l.tabIndex,"onUpdate:modelValue":e[9]||(e[9]=a=>l.tabIndex=a),"nav-class":"nav-tabs-custom"},{default:o(()=>[s(V,null,{title:o(()=>e[10]||(e[10]=[t("a",{class:"font-weight-bold active"},"Data",-1)])),default:o(()=>[t("div",G,[t("div",J,[e[11]||(e[11]=t("label",null,[t("strong",null,"Filter Kecamatan:")],-1)),s(g,{modelValue:l.selectedKecamatan,"onUpdate:modelValue":e[0]||(e[0]=a=>l.selectedKecamatan=a),options:i.uniqueKecamatan,placeholder:"-- Pilih Kecamatan --",class:"form-control"},null,8,["modelValue","options"])]),t("div",M,[e[12]||(e[12]=t("label",null,[t("strong",null,"Filter Kelurahan:")],-1)),s(g,{modelValue:l.selectedKelurahan,"onUpdate:modelValue":e[1]||(e[1]=a=>l.selectedKelurahan=a),options:i.uniqueKelurahan,disabled:!l.selectedKecamatan,placeholder:"-- Pilih Kelurahan --",class:"form-control"},null,8,["modelValue","options","disabled"])]),t("div",Y,[t("button",{class:"btn btn-sm btn-secondary mt-1",onClick:e[2]||(e[2]=(...a)=>i.resetFilters&&i.resetFilters(...a))},e[13]||(e[13]=[t("i",{class:"mdi mdi-refresh me-1"},null,-1),r(" Reset Filter ")]))])]),t("div",Q,[t("div",W,[t("button",{class:"btn btn-sm btn-primary",onClick:e[3]||(e[3]=(...a)=>i.onAddData&&i.onAddData(...a))},e[14]||(e[14]=[t("i",{class:"mdi mdi-plus me-1"},null,-1),r(" Tambah Data ")]))])]),t("div",X,[t("div",Z,[t("label",$,[e[15]||(e[15]=r(" Show  ")),s(g,{modelValue:l.perPage,"onUpdate:modelValue":e[4]||(e[4]=a=>l.perPage=a),size:"sm",options:l.pageOptions},null,8,["modelValue","options"]),e[16]||(e[16]=r(" entries "))])]),t("div",ee,[t("label",te,[e[17]||(e[17]=r(" Search: ")),s(P,{modelValue:l.filter,"onUpdate:modelValue":e[5]||(e[5]=a=>l.filter=a),type:"search",class:"form-control form-control-sm ms-2"},null,8,["modelValue"])])])]),t("div",ae,[s(C,{class:"table-centered datatable dt-responsive nowrap"},{default:o(()=>[s(T,{class:"table-light"},{default:o(()=>[s(k,null,{default:o(()=>[(p(!0),b(v,null,B(l.fields,a=>(p(),f(x,{key:a.key},{default:o(()=>[r(m(a.label)+" ",1),a.sortable?(p(),b("span",{key:0,onClick:y=>i.setSort(a.key),class:"cursor-pointer ms-1"},[t("i",{class:I(["mdi",l.sortKey===a.key?l.sortAsc?"mdi-arrow-up":"mdi-arrow-down":"mdi-swap-vertical"])},null,2)],8,le)):U("",!0)]),_:2},1024))),128))]),_:1})]),_:1}),s(A,null,{default:o(()=>[(p(!0),b(v,null,B(i.computedFilteredDataList,(a,y)=>(p(),f(k,{key:y},{default:o(()=>[s(c,null,{default:o(()=>[r(m(a.nama_cpcl),1)]),_:2},1024),s(c,null,{default:o(()=>[r(m(a.kontraktor_pelaksana),1)]),_:2},1024),s(c,null,{default:o(()=>[r(m(a.kegiatan),1)]),_:2},1024),s(c,null,{default:o(()=>[r(m(a.kecamatan),1)]),_:2},1024),s(c,null,{default:o(()=>[r(m(a.kelurahan),1)]),_:2},1024),s(c,null,{default:o(()=>[r(m(a.tanggal_selesai),1)]),_:2},1024),s(c,null,{default:o(()=>[r(m(a.photo_count),1)]),_:2},1024),s(c,null,{default:o(()=>[r(m(a.pdf_count),1)]),_:2},1024),s(c,null,{default:o(()=>[t("button",{type:"button",class:"btn btn-link text-primary p-0 me-2",title:"Edit",onClick:F=>i.goToEdit(a.id)},e[18]||(e[18]=[t("i",{class:"mdi mdi-pencil font-size-18"},null,-1)]),8,se),t("button",{type:"button",class:"btn btn-link text-danger p-0",title:"Delete",onClick:F=>i.deleteEntry(a.id)},e[19]||(e[19]=[t("i",{class:"mdi mdi-trash-can font-size-18"},null,-1)]),8,ne)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),t("div",oe,[t("div",re,[t("button",{class:"scroll-btn me-2",onClick:e[6]||(e[6]=a=>i.scrollPagination("left"))}," ‹ "),t("div",ie,[t("ul",de,[s(D,{modelValue:l.currentPage,"onUpdate:modelValue":e[7]||(e[7]=a=>l.currentPage=a),"total-rows":i.rows,"per-page":l.perPage,size:"md",class:"pagination-rounded"},null,8,["modelValue","total-rows","per-page"])])]),t("button",{class:"scroll-btn ms-2",onClick:e[8]||(e[8]=a=>i.scrollPagination("right"))}," › ")])])]),_:1})]),_:1},8,["modelValue"])])])])])]),_:1})}const fe=q(z,[["render",ue],["__scopeId","data-v-51c6e3f7"]]);export{fe as default};

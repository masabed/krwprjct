import{L as P,P as j}from"./page-header-7252a4a4.js";import{K as F}from"./KecKelurahanList-556de1ec.js";import{S as u}from"./sweetalert2.esm.all-cdd2d7a4.js";import{i as x}from"./browser-image-compression-a3ab6596.js";import{_ as C,h as v,j as o,E as S,q as V,m as K,l as e,s as _,A as D,t as p,G as b,k as i,B as g,F as h,v as c,y as L,x as d,H as N}from"./index-234163e1.js";import"./logo-dark-92140013.js";import"./SIIMAH-e113b49b.js";const U={name:"AddDataPerumahan",components:{Layout:P,PageHeader:j},data(){return{kelurahanList:F,bidangOptions:["Perumahan","Pertanahan","Permukiman","Air Minum"],isCompressing:!1,formData:{bidang:"",kegiatan:"",nik:"",nama_cpcl:"",dusun:"",kelurahan:"",kecamatan:"",no_surat:"",tanggal_sp:"",nilai_kontrak:null,jumlah_unit:null,type:"",kontraktor_pelaksana:"",tanggal_mulai:"",tanggal_selesai:"",waktu_kerja:null,pengawas_lapangan:"",pdfs:[],photos:[]},previewPhotos:[],previewPDFs:[],fieldLabels:{nik:"NIK",nama_cpcl:"Nama CPCL",kecamatan:"Kecamatan",kelurahan:"Kelurahan",dusun:"Dusun",no_surat:"No. Surat",tanggal_sp:"Tanggal SP",nilai_kontrak:"Nilai Kontrak",jumlah_unit:"Jumlah Unit",type:"Tipe",kontraktor_pelaksana:"Kontraktor Pelaksana",tanggal_mulai:"Tanggal Mulai",tanggal_selesai:"Tanggal Selesai",waktu_kerja:"Waktu Kerja (hari)",pengawas_lapangan:"Pengawas Lapangan"}}},methods:{inputType(n){return n.includes("tanggal")?"date":["nilai_kontrak","jumlah_unit","waktu_kerja"].includes(n)?"number":"text"},preventNegative(n){this.formData[n]<0&&(this.formData[n]=0)},formatCurrency(n){return!n&&n!==0?"":new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(n)},validateForm(){const n=this.formData.nik;return/^[0-9]{16}$/.test(n)?this.formData.nilai_kontrak<0?(u.fire("Validasi","Nilai kontrak tidak boleh negatif","warning"),!1):this.formData.jumlah_unit<0?(u.fire("Validasi","Jumlah unit tidak boleh negatif","warning"),!1):this.formData.waktu_kerja<0?(u.fire("Validasi","Waktu kerja tidak boleh negatif","warning"),!1):!0:(u.fire("Validasi","NIK harus 16 digit angka","warning"),!1)},async handleSinglePhoto(n){const a=n.target.files[0];if(a){if(this.formData.photos.length>=10){u.fire("Batas Foto","Maksimal 10 foto boleh diunggah.","warning");return}this.isCompressing=!0;try{const f=await x(a,{maxSizeMB:1,maxWidthOrHeight:1920,useWebWorker:!0});this.formData.photos.push(f),this.previewPhotos.push(URL.createObjectURL(f))}catch{u.fire("Gagal","Kompresi foto gagal.","error")}finally{this.isCompressing=!1}}},handlePDFs(n){const a=Array.from(n.target.files);this.formData.pdfs=a,this.previewPDFs=a.map(f=>f.name)},removePhoto(n){this.formData.photos.splice(n,1),this.previewPhotos.splice(n,1)},async submitForm(){var n;if(this.validateForm())try{const a=new FormData;for(const k in this.formData){const t=this.formData[k];Array.isArray(t)?t.forEach(l=>a.append(`${k}[]`,l)):a.append(k,t)}(await this.$axios.post("/perumahan/addData",a,{headers:{"Content-Type":"multipart/form-data"}})).data.success?u.fire("Sukses","Data berhasil disimpan","success").then(()=>{this.$router.push("/bidPerumahan/list")}):u.fire("Gagal","Data gagal disimpan","error")}catch(a){((n=a.response)==null?void 0:n.status)===401?u.fire("Sesi Habis","Silakan login kembali.","warning").then(()=>{localStorage.removeItem("access_token"),this.$router.push({name:"Login"})}):(u.fire("Error","Terjadi kesalahan server","error"),console.error(a))}}}},T={class:"card"},B={class:"card-body"},M={class:"row"},I={class:"col-md-6 mb-3"},A=["value"],H={class:"col-md-6 mb-3"},O={key:0,class:"mb-3"},W={class:"form-label"},E={class:"form-text"},G={key:1,class:"mb-3"},R={class:"form-label"},J={key:2,class:"mb-3"},q={class:"form-label"},z={key:3,class:"mb-3"},Q=["value"],X={key:4,class:"mb-3"},Y=["disabled"],Z=["value"],$={key:5,class:"mb-3"},aa={class:"form-label"},ea=["onUpdate:modelValue","type"],ta={class:"col-md-6 mb-3"},sa={class:"mt-2"},na={class:"col-md-6 mb-3"},ra=["disabled"],oa={class:"mt-2 d-flex flex-wrap gap-2"},ia=["src"],la=["onClick"],ma={key:0,class:"progress mt-2"},ua={class:"text-end"},da=["disabled"];function pa(n,a,f,k,t,l){const y=v("PageHeader"),w=v("Layout");return o(),S(w,null,{default:V(()=>[K(y,{title:"Tambah Data Perumahan",items:[{text:"Menu"},{text:"Bidang Perumahan",href:"/perumahan"},{text:"Tambah",active:!0}]}),e("div",T,[e("div",B,[e("form",{onSubmit:a[12]||(a[12]=_((...r)=>l.submitForm&&l.submitForm(...r),["prevent"]))},[e("div",M,[a[23]||(a[23]=e("div",{class:"alert alert-danger"},[e("strong",null,"Perhatian:"),D(" Semua field wajib diisi. "),e("br"),e("em",null,"Foto dan file dokumen bersifat opsional")],-1)),e("div",I,[a[14]||(a[14]=e("label",{class:"form-label"},"Bidang",-1)),p(e("select",{"onUpdate:modelValue":a[0]||(a[0]=r=>t.formData.bidang=r),class:"form-control"},[a[13]||(a[13]=e("option",{disabled:"",value:""},"-- Pilih Bidang --",-1)),(o(!0),i(h,null,g(t.bidangOptions,r=>(o(),i("option",{key:r,value:r},d(r),9,A))),128))],512),[[b,t.formData.bidang]])]),e("div",H,[a[15]||(a[15]=e("label",{class:"form-label"},"Kegiatan",-1)),p(e("input",{"onUpdate:modelValue":a[1]||(a[1]=r=>t.formData.kegiatan=r),type:"text",class:"form-control"},null,512),[[c,t.formData.kegiatan]])]),(o(!0),i(h,null,g(t.fieldLabels,(r,m)=>(o(),i("div",{class:"col-md-6",key:m},[m==="nilai_kontrak"?(o(),i("div",O,[e("label",W,d(r),1),p(e("input",{"onUpdate:modelValue":a[2]||(a[2]=s=>t.formData.nilai_kontrak=s),type:"number",class:"form-control",onInput:a[3]||(a[3]=s=>l.preventNegative("nilai_kontrak"))},null,544),[[c,t.formData.nilai_kontrak,void 0,{number:!0}]]),e("div",E,d(l.formatCurrency(t.formData.nilai_kontrak)),1)])):m==="jumlah_unit"?(o(),i("div",G,[e("label",R,d(r),1),p(e("input",{"onUpdate:modelValue":a[4]||(a[4]=s=>t.formData.jumlah_unit=s),type:"number",class:"form-control",onInput:a[5]||(a[5]=s=>l.preventNegative("jumlah_unit"))},null,544),[[c,t.formData.jumlah_unit,void 0,{number:!0}]])])):m==="waktu_kerja"?(o(),i("div",J,[e("label",q,d(r),1),p(e("input",{"onUpdate:modelValue":a[6]||(a[6]=s=>t.formData.waktu_kerja=s),type:"number",class:"form-control",onInput:a[7]||(a[7]=s=>l.preventNegative("waktu_kerja"))},null,544),[[c,t.formData.waktu_kerja,void 0,{number:!0}]])])):m==="kecamatan"?(o(),i("div",z,[a[17]||(a[17]=e("label",{class:"form-label"},"Kecamatan",-1)),p(e("select",{"onUpdate:modelValue":a[8]||(a[8]=s=>t.formData.kecamatan=s),class:"form-control"},[a[16]||(a[16]=e("option",{value:""},"-- Pilih Kecamatan --",-1)),(o(!0),i(h,null,g(Object.keys(t.kelurahanList),s=>(o(),i("option",{key:s,value:s},d(s),9,Q))),128))],512),[[b,t.formData.kecamatan]])])):m==="kelurahan"?(o(),i("div",X,[a[19]||(a[19]=e("label",{class:"form-label"},"Kelurahan",-1)),p(e("select",{"onUpdate:modelValue":a[9]||(a[9]=s=>t.formData.kelurahan=s),class:"form-control",disabled:!t.formData.kecamatan},[a[18]||(a[18]=e("option",{value:""},"-- Pilih Kelurahan --",-1)),(o(!0),i(h,null,g(t.kelurahanList[t.formData.kecamatan]||[],s=>(o(),i("option",{key:s,value:s},d(s),9,Z))),128))],8,Y),[[b,t.formData.kelurahan]])])):(o(),i("div",$,[e("label",aa,d(r),1),p(e("input",{"onUpdate:modelValue":s=>t.formData[m]=s,type:l.inputType(m),class:"form-control"},null,8,ea),[[N,t.formData[m]]])]))]))),128)),e("div",ta,[a[20]||(a[20]=e("label",{class:"form-label"},"Upload PDF",-1)),e("input",{type:"file",multiple:"",accept:".pdf",class:"form-control",onChange:a[10]||(a[10]=(...r)=>l.handlePDFs&&l.handlePDFs(...r))},null,32),e("ul",sa,[(o(!0),i(h,null,g(t.previewPDFs,(r,m)=>(o(),i("li",{key:m},d(r),1))),128))])]),e("div",na,[a[22]||(a[22]=e("label",{class:"form-label"},"Ambil Foto (Kamera)",-1)),e("input",{type:"file",accept:"image/*",capture:"environment",class:"form-control",onChange:a[11]||(a[11]=(...r)=>l.handleSinglePhoto&&l.handleSinglePhoto(...r)),disabled:t.formData.photos.length>=10||t.isCompressing},null,40,ra),e("div",oa,[(o(!0),i(h,null,g(t.previewPhotos,(r,m)=>(o(),i("div",{key:m,class:"position-relative"},[e("img",{src:r,style:{width:"100px",height:"100px","object-fit":"cover"}},null,8,ia),e("button",{class:"btn btn-sm btn-danger position-absolute top-0 end-0",onClick:_(s=>l.removePhoto(m),["prevent"])},"Ã—",8,la)]))),128))]),t.isCompressing?(o(),i("div",ma,a[21]||(a[21]=[e("div",{class:"progress-bar progress-bar-striped progress-bar-animated",style:{width:"100%"}}," Mengompres foto... ",-1)]))):L("",!0)])]),e("div",ua,[e("button",{class:"btn btn-primary",type:"submit",disabled:t.formData.photos.length<0||t.isCompressing},a[24]||(a[24]=[e("i",{class:"mdi mdi-content-save me-1"},null,-1),D(" Simpan ")]),8,da)])],32)])])]),_:1})}const _a=C(U,[["render",pa]]);export{_a as default};
